<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dise√±o de Sistema de Riego ‚Äì Sesi√≥n 2 | UNDC Agronom√≠a</title>
  <meta name="description" content="Sitio interactivo premium: Dise√±o de Sistema de Riego (Sesi√≥n 2) ‚Äì Sistema de Riego y Drenaje, UNDC Agronom√≠a." />
  <style>
    :root{
      --bg:#ffffff;
      --surface:#ffffff;
      --ink:#0b1220;
      --muted:#586070;
      --line:rgba(10,20,40,.12);
      --shadow: 0 14px 40px rgba(0,0,0,.10);
      --shadow2: 0 10px 30px rgba(0,0,0,.08);
      --brand:#0d5bd7;
      --brand2:#6a5cff;
      --accent:#00b894;
      --warn:#ffb703;
      --danger:#ff4d6d;

      --radius: 18px;
      --radius2: 28px;
      --max: 1120px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --grad: radial-gradient(1200px 600px at 15% -10%, rgba(13,91,215,.18), transparent 55%),
              radial-gradient(900px 500px at 92% 8%, rgba(106,92,255,.16), transparent 55%),
              radial-gradient(900px 500px at 55% 105%, rgba(0,184,148,.12), transparent 55%),
              linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,1));
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      background: var(--grad);
      overflow-x:hidden;
    }

    /* Top progress bar */
    .progress{
      position:fixed; inset:0 0 auto 0;
      height:4px;
      background:rgba(13,91,215,.12);
      z-index:9999;
    }
    .progress > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--brand), var(--brand2), var(--accent));
      box-shadow: 0 10px 20px rgba(13,91,215,.25);
      transition: width .1s linear;
    }

    /* Sticky header */
    header{
      position:sticky; top:0;
      z-index:1000;
      backdrop-filter: blur(14px);
      background: rgba(255,255,255,.78);
      border-bottom:1px solid var(--line);
    }
    .nav{
      max-width:var(--max);
      margin:0 auto;
      padding:12px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width:240px;
    }
    .logoRow{display:flex; gap:8px; align-items:center}
    .logo{
      width:40px;height:40px;border-radius:12px;
      background: linear-gradient(145deg, rgba(13,91,215,.15), rgba(106,92,255,.10));
      border:1px solid rgba(13,91,215,.22);
      display:grid; place-items:center;
      box-shadow: 0 10px 30px rgba(13,91,215,.10);
      overflow:hidden;
    }
    .logo svg{width:28px;height:28px}
    .brand h1{margin:0; font-size:14px; line-height:1.1}
    .brand p{margin:2px 0 0; font-size:12px; color:var(--muted)}
    nav{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      font-size:13px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      color:var(--ink);
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.04);
      user-select:none;
    }
    .pill:hover{transform: translateY(-1px); box-shadow: var(--shadow2)}
    .pill.primary{
      border-color: rgba(13,91,215,.28);
      background: linear-gradient(90deg, rgba(13,91,215,.10), rgba(106,92,255,.10));
    }
    .pill strong{font-weight:700}
    .pill .dot{
      width:8px;height:8px;border-radius:99px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(0,184,148,.12);
    }

    main{max-width:var(--max); margin:0 auto; padding:18px 16px 90px}

    /* Hero */
    .hero{
      position:relative;
      margin-top:12px;
      border:1px solid var(--line);
      border-radius: var(--radius2);
      overflow:hidden;
      background:
        radial-gradient(800px 420px at 18% 30%, rgba(13,91,215,.16), transparent 60%),
        radial-gradient(680px 420px at 85% 20%, rgba(106,92,255,.18), transparent 58%),
        radial-gradient(680px 420px at 65% 95%, rgba(0,184,148,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.80));
      box-shadow: var(--shadow);
    }
    .heroInner{
      padding: 28px 22px;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .heroInner{grid-template-columns:1fr; }
      .brand{min-width:auto}
    }

    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(13,91,215,.18);
      background: rgba(13,91,215,.06);
      color: #0d3aa1;
      font-weight:600;
      font-size:12px;
    }
    .kicker .spark{
      width:18px;height:18px;border-radius:10px;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 10px 25px rgba(13,91,215,.25);
      position:relative;
    }
    .kicker .spark::after{
      content:"";
      position:absolute; inset:5px;
      border-radius:8px;
      background: rgba(255,255,255,.70);
      transform: rotate(20deg);
      clip-path: polygon(50% 0, 62% 38%, 100% 50%, 62% 62%, 50% 100%, 38% 62%, 0 50%, 38% 38%);
    }

    .hero h2{
      margin:14px 0 10px;
      font-size: 34px;
      line-height:1.05;
      letter-spacing:-.02em;
    }
    .hero h2 span{
      background: linear-gradient(90deg, var(--brand), var(--brand2), var(--accent));
      -webkit-background-clip: text;
      background-clip:text;
      color:transparent;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:15px;
      line-height:1.55;
      max-width: 64ch;
    }
    .ctaRow{
      margin-top: 16px;
      display:flex; flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .btn{
      border:none;
      border-radius: 14px;
      padding:12px 14px;
      font-weight:700;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:10px;
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      color:white;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 18px 45px rgba(13,91,215,.22);
    }
    .btn.ghost{
      background: rgba(255,255,255,.85);
      border:1px solid var(--line);
      color:var(--ink);
      box-shadow: 0 12px 35px rgba(0,0,0,.06);
    }
    .btn:hover{filter:saturate(1.05); box-shadow: var(--shadow)}
    .mini{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 14px;
    }
    .tag{
      border:1px solid var(--line);
      background: rgba(255,255,255,.75);
      border-radius: 999px;
      padding:7px 10px;
      color:var(--muted);
      font-size:12px;
      display:inline-flex; align-items:center; gap:8px;
    }
    .tag b{color:var(--ink)}
    .tag .chip{
      width:10px;height:10px;border-radius:99px;
      background: rgba(13,91,215,.35);
      box-shadow: 0 0 0 4px rgba(13,91,215,.10);
    }

    /* Right panel in hero */
    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.86);
      box-shadow: 0 12px 35px rgba(0,0,0,.06);
      overflow:hidden;
      display:flex; flex-direction:column;
      min-height: 260px;
    }
    .panelHead{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
    }
    .panelHead h3{margin:0; font-size:13px; color:var(--muted); font-weight:700; letter-spacing:.02em; text-transform:uppercase}
    .badge{
      font-size:12px; font-weight:800;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,184,148,.12);
      color: #01695a;
      border:1px solid rgba(0,184,148,.22);
    }
    .panelBody{padding:14px; display:grid; gap:10px}
    .stat{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
    }
    .stat .k{font-size:12px; color:var(--muted); font-weight:700}
    .stat .v{font-size:13px; font-weight:800}
    .stat .v small{font-weight:700; color:var(--muted)}
    .pulse{
      width:10px;height:10px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 0 rgba(0,184,148,.25);
      animation: pulse 2.2s infinite;
      margin-right:8px;
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(0,184,148,.28)}
      70%{box-shadow:0 0 0 12px rgba(0,184,148,0)}
      100%{box-shadow:0 0 0 0 rgba(0,184,148,0)}
    }

    /* Sections */
    section{margin-top:26px}
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 6;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.86);
      box-shadow: 0 12px 35px rgba(0,0,0,.06);
      overflow:hidden;
      position:relative;
    }
    .card.wide{grid-column: span 12}
    .card.third{grid-column: span 4}
    .card.quarter{grid-column: span 3}
    @media (max-width: 920px){
      .card, .card.third, .card.quarter{grid-column: span 12}
    }
    .cardHead{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .cardHead h3{margin:0; font-size:15px}
    .cardHead .hint{font-size:12px; color:var(--muted); font-weight:700}
    .cardBody{padding:14px}
    .bullets{margin:0; padding-left: 18px; color:var(--muted); line-height:1.6}
    .bullets li{margin: 6px 0}
    .chips{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px
    }
    .chipPill{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.90);
      color:var(--ink);
      display:inline-flex; align-items:center; gap:8px;
      font-weight:700;
    }
    .chipPill .ico{
      width:18px;height:18px;border-radius:10px;
      background: rgba(13,91,215,.10);
      border:1px solid rgba(13,91,215,.18);
      display:grid; place-items:center;
      font-size:12px;
    }

    /* Accordion */
    details{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.85);
      margin: 10px 0;
      overflow:hidden;
    }
    details summary{
      cursor:pointer;
      padding:12px 12px;
      list-style:none;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      font-weight:800;
    }
    details summary::-webkit-details-marker{display:none}
    details summary .m{color:var(--muted); font-weight:700; font-size:12px}
    details .content{padding: 0 12px 12px; color:var(--muted); line-height:1.6}

    /* Calculator */
    .calc{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
      align-items:end;
    }
    .field{
      grid-column: span 2;
      display:grid;
      gap:6px;
    }
    .field.wide{grid-column: span 3}
    .field.full{grid-column: span 6}
    .field label{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      letter-spacing:.01em;
    }
    .field input, .field select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.95);
      font-family: var(--font);
      outline:none;
      transition: box-shadow .12s ease, border-color .12s ease;
    }
    .field input:focus, .field select:focus{
      border-color: rgba(13,91,215,.30);
      box-shadow: 0 0 0 4px rgba(13,91,215,.12);
    }
    .out{
      padding:12px 12px;
      border-radius: 14px;
      border:1px dashed rgba(13,91,215,.25);
      background: rgba(13,91,215,.05);
      color: #0d3aa1;
      font-family: var(--mono);
      font-weight:800;
      letter-spacing:.01em;
      white-space: pre-wrap;
      line-height:1.4;
    }
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}

    /* Quiz */
    .quizHeader{
      display:flex; justify-content:space-between; align-items:flex-end; flex-wrap:wrap;
      gap:12px;
      margin-bottom: 10px;
    }
    .quizHeader .who{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .quizHeader .who .field{grid-column:unset}
    .qList{display:grid; gap:10px}
    .q{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.90);
      padding:12px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .q:hover{transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.06)}
    .qTop{
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    }
    .qTitle{
      margin:0;
      font-weight:900;
      font-size:14px;
      line-height:1.35;
    }
    .qMeta{font-size:12px;color:var(--muted); font-weight:800}
    .opts{margin-top:10px; display:grid; gap:8px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
      cursor:pointer;
      user-select:none;
      transition: box-shadow .12s ease, transform .12s ease, border-color .12s ease;
    }
    .opt:hover{transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,.06)}
    .opt input{margin-top:2px}
    .opt.correct{border-color: rgba(0,184,148,.35); box-shadow: 0 0 0 4px rgba(0,184,148,.10)}
    .opt.wrong{border-color: rgba(255,77,109,.35); box-shadow: 0 0 0 4px rgba(255,77,109,.08)}
    .scoreBox{
      border:1px solid rgba(13,91,215,.22);
      background: rgba(13,91,215,.06);
      border-radius: 16px;
      padding:12px;
      min-width: 260px;
    }
    .scoreBox .big{
      font-size:22px; font-weight:1000; letter-spacing:-.02em;
      background: linear-gradient(90deg, var(--brand), var(--brand2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      margin:0;
    }
    .scoreBox .small{margin:4px 0 0; color:var(--muted); font-weight:800; font-size:12px}

    /* Footer */
    footer{
      margin-top: 34px;
      border-top:1px solid var(--line);
      padding-top: 16px;
      color: var(--muted);
      font-size:12px;
      line-height:1.6;
    }
    .footerGrid{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }

    /* Presentation mode */
    body.presentation header, body.presentation .progress{display:none}
    body.presentation main{max-width: 1280px}
    body.presentation .hero{box-shadow:none}
    body.presentation .card{box-shadow:none}
    body.presentation .pill, body.presentation .btn.ghost{display:none}
    body.presentation .btn.primary{border-radius: 999px}
    body.presentation .heroInner{padding: 18px 14px}

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background: rgba(11,18,32,.92);
      color:white;
      padding:10px 12px;
      border-radius: 999px;
      font-size:13px;
      font-weight:800;
      box-shadow: 0 18px 45px rgba(0,0,0,.22);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 9999;
      display:flex; align-items:center; gap:10px;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-2px)}
    .toast .tDot{width:9px;height:9px;border-radius:99px;background: var(--accent); box-shadow:0 0 0 4px rgba(0,184,148,.18)}
  </style>
</head>

<body>
  <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>

  <header>
    <div class="nav">
      <div class="brand">
        <div class="logoRow" aria-label="Logos UNDC y Agronom√≠a (placeholders)">
          <div class="logo" title="UNDC (placeholder)">
            <!-- Simple isologo placeholder -->
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4z" stroke="rgba(13,91,215,.95)" stroke-width="1.6"/>
              <path d="M8.3 12.2l2.1 2.2 5.3-5.6" stroke="rgba(0,184,148,.95)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="logo" title="Agronom√≠a (placeholder)">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 21s7-2.8 7-9.5C19 6.6 15.9 4 12 4S5 6.6 5 11.5C5 18.2 12 21 12 21z" stroke="rgba(106,92,255,.95)" stroke-width="1.6"/>
              <path d="M12 7v11" stroke="rgba(13,91,215,.85)" stroke-width="1.6" stroke-linecap="round"/>
              <path d="M12 12c2.8 0 4.8-1.3 6-3.2" stroke="rgba(0,184,148,.85)" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </div>
        </div>

        <div>
          <h1>UNDC ¬∑ Agronom√≠a ¬∑ Sistema de Riego y Drenaje</h1>
          <p>Sesi√≥n 2: <b>Dise√±o de Sistema de Riego</b> ¬∑ Docente: <b>Dr. Julio C√©sar Matos Lizana</b></p>
        </div>
      </div>

      <nav aria-label="Navegaci√≥n">
        <a class="pill" href="#mapa">Mapa</a>
        <a class="pill" href="#gravedad">Gravedad</a>
        <a class="pill" href="#tecnificado">Tecnificado</a>
        <a class="pill" href="#calculadoras">Calculadoras</a>
        <a class="pill primary" href="#quiz"><span class="dot"></span><strong>Quiz (10)</strong></a>
        <button class="pill" id="btnPresent" type="button" title="Modo presentaci√≥n (pantalla completa)">üé¨ Modo presentaci√≥n</button>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" id="inicio">
      <div class="heroInner">
        <div>
          <div class="kicker"><span class="spark"></span> Clase premium ¬∑ Interactiva ¬∑ Lista para aula</div>
          <h2>Dise√±o de <span>Sistemas de Riego</span> con criterios t√©cnicos, c√°lculo r√°pido y evaluaci√≥n.</h2>
          <p class="sub">
            En esta sesi√≥n trabajaremos desde el <b>riego por gravedad</b> (surcos, melgas, inundaci√≥n) hasta el
            <b>riego tecnificado</b> (aspersi√≥n, microaspersi√≥n, goteo y subsuperficial), conectando
            <b>cultivo‚Äìagua‚Äìsuelo‚Äìclima</b> con eficiencia y uniformidad.
          </p>
          <div class="ctaRow">
            <button class="btn primary" id="btnArranque" type="button">üöÄ Iniciar recorrido guiado</button>
            <button class="btn ghost" id="btnDiagnostico" type="button">üß≠ Diagn√≥stico r√°pido (elige sistema)</button>
            <button class="btn ghost" id="btnDescargar" type="button">‚¨áÔ∏è Exportar resultados (CSV)</button>
          </div>
          <div class="mini">
            <div class="tag"><span class="chip"></span><b>Objetivo:</b> distribuci√≥n uniforme y eficiente</div>
            <div class="tag"><span class="chip"></span><b>Herramienta:</b> c√°lculo de l√°mina y caudal</div>
            <div class="tag"><span class="chip"></span><b>Evaluaci√≥n:</b> quiz con registro</div>
          </div>
        </div>

        <aside class="panel" aria-label="Panel de control">
          <div class="panelHead">
            <h3>Panel de control</h3>
            <span class="badge">Sesi√≥n 2 ¬∑ UNDC</span>
          </div>
          <div class="panelBody">
            <div class="stat">
              <div class="k"><span class="pulse"></span>Estado</div>
              <div class="v" id="statusTxt">Listo para aprender</div>
            </div>
            <div class="stat">
              <div class="k">Progreso</div>
              <div class="v"><span id="progPct">0</span><small>%</small></div>
            </div>
            <div class="stat">
              <div class="k">Puntaje guardado</div>
              <div class="v" id="savedScore">‚Äî</div>
            </div>
            <div class="stat">
              <div class="k">Modo</div>
              <div class="v" id="modeTxt">Normal</div>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section id="mapa">
      <div class="grid">
        <div class="card wide">
          <div class="cardHead">
            <h3>Mapa de aprendizaje (Sesi√≥n 2)</h3>
            <div class="hint">Haz clic: abre/cierra</div>
          </div>
          <div class="cardBody">
            <details open>
              <summary>1) Riego por gravedad <span class="m">principios, m√©todos, eficiencia</span></summary>
              <div class="content">
                En riego por gravedad, el agua se distribuye por pendiente natural (sin bombeo).
                Se busca que la l√°mina aplicada sea la requerida por el cultivo y que la humedad sea uniforme en la zona radicular,
                evitando percolaci√≥n profunda, escorrent√≠a y erosi√≥n.
              </div>
            </details>
            <details>
              <summary>2) Par√°metros y ejemplo <span class="m">suelo, pendiente, caudal, longitud</span></summary>
              <div class="content">
                Se consideran textura del suelo, pendiente del terreno, caudal y uniformidad.
                Veremos un ejemplo de ma√≠z en surcos.
              </div>
            </details>
            <details>
              <summary>3) C√°lculo de l√°mina de riego <span class="m">ETc ‚Üí LR ‚Üí Volumen ‚Üí Tiempo</span></summary>
              <div class="content">
                Calcularemos ETc con ETo√óFT√óKc, luego LR = ETc / eficiencia y convertiremos a volumen para estimar tiempo.
              </div>
            </details>
            <details>
              <summary>4) Riego tecnificado <span class="m">aspersi√≥n, micro, goteo, subsuperficial</span></summary>
              <div class="content">
                M√©todos modernos con aplicaci√≥n controlada y localizada, con ventajas de ahorro de agua y productividad.
              </div>
            </details>
            <details>
              <summary>5) Dise√±o de tecnificado <span class="m">estudio previo, hidr√°ulica, cabezal</span></summary>
              <div class="content">
                Incluye estudio previo (cultivo‚Äìclima‚Äìsuelo‚Äìagua), selecci√≥n del sistema, dise√±o hidr√°ulico,
                infraestructura complementaria (bomba, filtros, v√°lvulas, fertirriego) y criterios de uniformidad.
              </div>
            </details>
          </div>
        </div>
      </div>
    </section>

    <section id="gravedad">
      <div class="grid">
        <div class="card">
          <div class="cardHead">
            <h3>Riego por gravedad</h3>
            <div class="hint">Concepto + importancia</div>
          </div>
          <div class="cardBody">
            <ul class="bullets">
              <li><b>Definici√≥n:</b> distribuci√≥n del agua aprovechando la pendiente natural y la energ√≠a gravitatoria (sin bombeo).</li>
              <li><b>Importancia:</b> bajo costo energ√©tico, f√°cil implementaci√≥n en zonas rurales, com√∫n en cultivos extensivos.</li>
              <li><b>Meta t√©cnica:</b> aplicar la l√°mina requerida y distribuir humedad uniformemente en la zona de ra√≠ces.</li>
            </ul>
            <div class="chips">
              <span class="chipPill"><span class="ico">‚õ∞Ô∏è</span>Topograf√≠a</span>
              <span class="chipPill"><span class="ico">üíß</span>Caudal</span>
              <span class="chipPill"><span class="ico">üß±</span>Textura</span>
              <span class="chipPill"><span class="ico">üìè</span>Uniformidad</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <h3>Principios b√°sicos de dise√±o</h3>
            <div class="hint">Lo que se eval√∫a primero</div>
          </div>
          <div class="cardBody">
            <ul class="bullets">
              <li><b>Disponibilidad de agua:</b> caudal, calidad y continuidad.</li>
              <li><b>Pendiente del terreno:</b> define m√©todo (surcos, melgas, bordos).</li>
              <li><b>Textura del suelo:</b> arenosos (alta infiltraci√≥n) vs. arcillosos (baja infiltraci√≥n).</li>
              <li><b>Uniformidad:</b> distribuci√≥n equitativa del agua.</li>
            </ul>
            <details>
              <summary>Checklist de campo <span class="m">para eficiencia</span></summary>
              <div class="content">
                Barbecho uniforme, rastreo (simple/doble), empareje y nivelaci√≥n (l√°ser o mec√°nico), buen trazo de riego y regaderas,
                desag√ºes para excesos, y gasto √≥ptimo para igual l√°mina infiltrada a lo largo del surco/melga.
              </div>
            </details>
          </div>
        </div>

        <div class="card wide">
          <div class="cardHead">
            <h3>M√©todos de riego por gravedad</h3>
            <div class="hint">¬øCu√°ndo usar cada uno?</div>
          </div>
          <div class="cardBody">
            <div class="grid">
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">üåæ Melgas (bordos)</p>
                  <p class="qMeta">L√°mina sobre parcela rectangular. √ötil en suelos planos y pesados.</p>
                </div>
              </div>
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">üßµ Surcos</p>
                  <p class="qMeta">Canales entre hileras. Mejor control y menor erosi√≥n (ma√≠z, algod√≥n, ca√±a, etc.).</p>
                </div>
              </div>
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">üåä Inundaci√≥n</p>
                  <p class="qMeta">Cobertura total del terreno. Muy usado en arrozales.</p>
                </div>
              </div>
            </div>

            <details>
              <summary>Dato clave: infiltraci√≥n <span class="m">regla pr√°ctica</span></summary>
              <div class="content">
                Si la velocidad de infiltraci√≥n es <b>&gt; 10 cm/h</b>, no se recomiendan m√©todos de riego por gravedad.
                El gasto de riego debe ser ‚â§ a la velocidad media de infiltraci√≥n.
              </div>
            </details>
          </div>
        </div>

        <div class="card wide">
          <div class="cardHead">
            <h3>Ejemplo r√°pido (ma√≠z en surcos)</h3>
            <div class="hint">Par√°metros de referencia</div>
          </div>
          <div class="cardBody">
            <div class="out" id="ejGravedad">
Suelo: franco-arcilloso
Pendiente: 0.1%
M√©todo: surcos (ma√≠z)
Longitud √≥ptima de surco: 100‚Äì150 m
Separaci√≥n de surcos: 0.8 m
Caudal unitario recomendado: 1‚Äì2 L/s por surco
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="tecnificado">
      <div class="grid">
        <div class="card">
          <div class="cardHead">
            <h3>Riego tecnificado (presurizado)</h3>
            <div class="hint">Concepto + importancia</div>
          </div>
          <div class="cardBody">
            <ul class="bullets">
              <li><b>Concepto:</b> m√©todos modernos para aplicar agua de forma controlada, eficiente y localizada.</li>
              <li><b>Importancia:</b> ahorro de agua (‚âà30‚Äì60%), mayor productividad y posibilidad de fertirriego.</li>
              <li><b>Enfoque:</b> adaptaci√≥n al cambio clim√°tico y escasez h√≠drica.</li>
            </ul>
            <div class="chips">
              <span class="chipPill"><span class="ico">üéØ</span>Localizado</span>
              <span class="chipPill"><span class="ico">‚öôÔ∏è</span>Presi√≥n</span>
              <span class="chipPill"><span class="ico">üß™</span>Fertirriego</span>
              <span class="chipPill"><span class="ico">üåç</span>Sostenibilidad</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <h3>Tipos principales</h3>
            <div class="hint">Selecci√≥n por contexto</div>
          </div>
          <div class="cardBody">
            <details open>
              <summary>‚òî Aspersi√≥n <span class="m">imita lluvia</span></summary>
              <div class="content">
                Convencional, pivote central, cobertura total. Ventajas: buena uniformidad, varios cultivos.
                Limitaciones: viento, evaporaci√≥n y costo energ√©tico.
              </div>
            </details>
            <details>
              <summary>üå´Ô∏è Microaspersi√≥n <span class="m">bajo caudal</span></summary>
              <div class="content">
                Frutales, viveros e invernaderos; mejora microclima (humedad relativa).
              </div>
            </details>
            <details>
              <summary>üíß Goteo <span class="m">m√°ximo ahorro</span></summary>
              <div class="content">
                Aplicaci√≥n directa al pie de planta; fertirriego preciso; ideal en frutales, hortalizas, vid e invernaderos.
              </div>
            </details>
            <details>
              <summary>ü™± Subsuperficial <span class="m">tuber√≠as enterradas</span></summary>
              <div class="content">
                Menor evaporaci√≥n y alta durabilidad; requiere buen mantenimiento.
              </div>
            </details>
          </div>
        </div>

        <div class="card wide">
          <div class="cardHead">
            <h3>Etapas del dise√±o (tecnificado)</h3>
            <div class="hint">de estudio previo a hidr√°ulica</div>
          </div>
          <div class="cardBody">
            <div class="grid">
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">1) Estudio previo</p>
                  <p class="qMeta">Cultivo (fenolog√≠a/espaciamiento), clima (ET0, viento), suelo (textura/infiltraci√≥n), agua (caudal/calidad/presi√≥n).</p>
                </div>
              </div>
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">2) Necesidades h√≠dricas</p>
                  <p class="qMeta">ETc = ETo √ó Kc, l√°mina y frecuencia de riego.</p>
                </div>
              </div>
              <div class="card third" style="box-shadow:none; background:transparent; border:none">
                <div class="q" style="padding:14px">
                  <p class="qTitle">3) Dise√±o hidr√°ulico</p>
                  <p class="qMeta">Caudal/presi√≥n, di√°metros, p√©rdidas de carga y uniformidad (variaci√≥n ‚â§ 20% en laterales).</p>
                </div>
              </div>
            </div>

            <details>
              <summary>Infraestructura complementaria <span class="m">cabezal y red</span></summary>
              <div class="content">
                Fuente (pozo/reservorio/canal), bombas, filtros (arena/malla/disco), inyector de fertilizantes,
                v√°lvulas (regulaci√≥n/seguridad), caudal√≠metro, man√≥metros y (opcional) automatizaci√≥n.
              </div>
            </details>
          </div>
        </div>
      </div>
    </section>

    <section id="calculadoras">
      <div class="grid">
        <div class="card wide">
          <div class="cardHead">
            <h3>Calculadora 1 ¬∑ L√°mina de riego (ETc ‚Üí LR ‚Üí Volumen ‚Üí Tiempo)</h3>
            <div class="hint">Basado en la sesi√≥n</div>
          </div>
          <div class="cardBody">
            <div class="calc" role="group" aria-label="Calculadora l√°mina de riego">
              <div class="field">
                <label for="eto">ETo (mm)</label>
                <input id="eto" inputmode="decimal" placeholder="Ej. 5" value="5" />
              </div>
              <div class="field">
                <label for="ft">FT (factor tanque)</label>
                <input id="ft" inputmode="decimal" placeholder="Ej. 0.8" value="0.8" />
              </div>
              <div class="field">
                <label for="kc">Kc (coeficiente)</label>
                <input id="kc" inputmode="decimal" placeholder="Ej. 0.7" value="0.7" />
              </div>
              <div class="field">
                <label for="ef">Eficiencia (0‚Äì1)</label>
                <input id="ef" inputmode="decimal" placeholder="Ej. 0.9" value="0.9" />
              </div>
              <div class="field">
                <label for="area">√Årea (ha)</label>
                <input id="area" inputmode="decimal" placeholder="Ej. 1" value="1" />
              </div>
              <div class="field">
                <label for="gasto">Gasto (m¬≥/h)</label>
                <input id="gasto" inputmode="decimal" placeholder="Ej. 15" value="15" />
              </div>

              <div class="field full">
                <div class="out" id="outLamina">Ingresa datos para calcular‚Ä¶</div>
              </div>
            </div>
            <div class="btnRow">
              <button class="btn primary" id="btnCalc1" type="button">üßÆ Calcular</button>
              <button class="btn ghost" id="btnReset1" type="button">‚Ü©Ô∏è Reiniciar</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <h3>Calculadora 2 ¬∑ Caudal por emisores (goteo)</h3>
            <div class="hint">Chequeo r√°pido</div>
          </div>
          <div class="cardBody">
            <div class="calc">
              <div class="field wide">
                <label for="nplantas">N¬∞ de plantas</label>
                <input id="nplantas" inputmode="numeric" placeholder="Ej. 3332" value="3332"/>
              </div>
              <div class="field wide">
                <label for="ngoteros">Goteros por planta</label>
                <input id="ngoteros" inputmode="numeric" placeholder="Ej. 2" value="2"/>
              </div>
              <div class="field wide">
                <label for="qgot">Caudal gotero (L/h)</label>
                <input id="qgot" inputmode="decimal" placeholder="Ej. 4" value="4"/>
              </div>
              <div class="field full">
                <div class="out" id="outEmisores">Ingresa datos para calcular‚Ä¶</div>
              </div>
            </div>
            <div class="btnRow">
              <button class="btn primary" id="btnCalc2" type="button">üßÆ Calcular</button>
              <button class="btn ghost" id="btnReset2" type="button">‚Ü©Ô∏è Reiniciar</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <h3>Diagn√≥stico r√°pido</h3>
            <div class="hint">elige sistema recomendado</div>
          </div>
          <div class="cardBody">
            <div class="calc">
              <div class="field full">
                <label for="topo">Topograf√≠a</label>
                <select id="topo">
                  <option value="plano">Plana / suave</option>
                  <option value="ondulada">Ondulada</option>
                  <option value="ladera">Ladera / pendiente marcada</option>
                </select>
              </div>
              <div class="field full">
                <label for="suelo">Textura del suelo</label>
                <select id="suelo">
                  <option value="arenoso">Arenoso / ligero (alta infiltraci√≥n)</option>
                  <option value="franco">Franco (intermedio)</option>
                  <option value="arcilloso">Arcilloso / pesado (baja infiltraci√≥n)</option>
                </select>
              </div>
              <div class="field full">
                <label for="agua">Disponibilidad de agua</label>
                <select id="agua">
                  <option value="alta">Alta y continua</option>
                  <option value="media">Media / variable</option>
                  <option value="baja">Baja / escasa</option>
                </select>
              </div>
              <div class="field full">
                <label for="cult">Tipo de cultivo</label>
                <select id="cult">
                  <option value="extensivo">Extensivo (ma√≠z, ca√±a, alfalfa)</option>
                  <option value="frutal">Frutal (vid, c√≠tricos, palto)</option>
                  <option value="hortaliza">Hortaliza / invernadero</option>
                </select>
              </div>
              <div class="field full">
                <div class="out" id="outDiag">Responde y presiona ‚ÄúEvaluar‚Äù.</div>
              </div>
            </div>
            <div class="btnRow">
              <button class="btn primary" id="btnDiag" type="button">üß≠ Evaluar</button>
              <button class="btn ghost" id="btnResetDiag" type="button">‚Ü©Ô∏è Reiniciar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="quiz">
      <div class="grid">
        <div class="card wide">
          <div class="cardHead">
            <h3>Quiz (10 preguntas) ¬∑ Sesi√≥n 2</h3>
            <div class="hint">Registra nombre y apellido ¬∑ guarda puntaje</div>
          </div>
          <div class="cardBody">
            <div class="quizHeader">
              <div class="who">
                <div class="field" style="min-width:220px">
                  <label for="qNombre">Nombre</label>
                  <input id="qNombre" placeholder="Ej. Mar√≠a" />
                </div>
                <div class="field" style="min-width:220px">
                  <label for="qApellido">Apellido</label>
                  <input id="qApellido" placeholder="Ej. P√©rez" />
                </div>
                <div class="field" style="min-width:240px">
                  <label for="qSeccion">Secci√≥n / Grupo</label>
                  <input id="qSeccion" placeholder="Ej. VI ciclo - A" />
                </div>
              </div>

              <div class="scoreBox" aria-live="polite">
                <p class="big" id="scoreBig">0 / 10</p>
                <p class="small" id="scoreSmall">Selecciona tus respuestas y presiona ‚ÄúCalificar‚Äù.</p>
              </div>
            </div>

            <div class="qList" id="qList"></div>

            <div class="btnRow" style="margin-top:14px">
              <button class="btn primary" id="btnGrade" type="button">‚úÖ Calificar</button>
              <button class="btn ghost" id="btnSave" type="button">üíæ Guardar puntaje</button>
              <button class="btn ghost" id="btnClear" type="button">üßΩ Limpiar</button>
            </div>

            <details style="margin-top:14px">
              <summary>Modo evaluaci√≥n (docente) <span class="m">ver clave + exportar CSV</span></summary>
              <div class="content">
                <div class="btnRow">
                  <button class="btn ghost" id="btnToggleKey" type="button">üîê Mostrar/Ocultar clave</button>
                  <button class="btn ghost" id="btnExport" type="button">‚¨áÔ∏è Exportar CSV (registro local)</button>
                </div>
                <div class="out" id="keyBox" style="display:none; margin-top:10px"></div>
                <p style="margin:10px 0 0; color:var(--muted); font-weight:700; font-size:12px">
                  Nota: el registro se guarda en este navegador (localStorage). Para otro equipo, exporta CSV.
                </p>
              </div>
            </details>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="footerGrid">
        <div>
          <b>Universidad Nacional de Ca√±ete ‚Äì Escuela Profesional de Agronom√≠a</b><br/>
          Curso: <b>Sistema de Riego y Drenaje</b> ¬∑ Sesi√≥n 2: Dise√±o de Sistema de Riego
        </div>
        <div>
          Docente: <b>Dr. Julio C√©sar Matos Lizana</b><br/>
          <span id="footTime"></span>
        </div>
      </div>
    </footer>
  </main>

  <div class="toast" id="toast"><span class="tDot"></span><span id="toastTxt">Listo</span></div>

  <script>
    // ---------- Helpers ----------
    const $ = (q)=>document.querySelector(q);
    const $$ = (q)=>Array.from(document.querySelectorAll(q));
    const clamp = (n,a,b)=>Math.max(a, Math.min(b,n));

    function toast(msg){
      const el = $("#toast");
      $("#toastTxt").textContent = msg;
      el.classList.add("show");
      window.clearTimeout(toast._t);
      toast._t = window.setTimeout(()=>el.classList.remove("show"), 2200);
    }

    function fmt(n, digits=2){
      if (!isFinite(n)) return "‚Äî";
      return new Intl.NumberFormat("es-PE", {maximumFractionDigits: digits, minimumFractionDigits: digits}).format(n);
    }

    // ---------- Top progress ----------
    const progressBar = $("#progressBar");
    const progPct = $("#progPct");
    function updateProgress(){
      const h = document.documentElement;
      const sc = h.scrollTop || document.body.scrollTop;
      const max = (h.scrollHeight - h.clientHeight) || 1;
      const p = clamp((sc/max)*100, 0, 100);
      progressBar.style.width = p.toFixed(1) + "%";
      progPct.textContent = Math.round(p);
    }
    document.addEventListener("scroll", updateProgress, {passive:true});
    updateProgress();

    // ---------- Footer time ----------
    $("#footTime").textContent = "Generado: " + new Date().toLocaleString("es-PE");

    // ---------- Presentation mode ----------
    const modeTxt = $("#modeTxt");
    $("#btnPresent").addEventListener("click", async ()=>{
      try{
        document.body.classList.toggle("presentation");
        const isOn = document.body.classList.contains("presentation");
        modeTxt.textContent = isOn ? "Presentaci√≥n" : "Normal";
        $("#statusTxt").textContent = isOn ? "Modo presentaci√≥n activo" : "Listo para aprender";
        toast(isOn ? "Modo presentaci√≥n activado" : "Modo presentaci√≥n desactivado");
        if (isOn && !document.fullscreenElement){
          await document.documentElement.requestFullscreen();
        } else if (!isOn && document.fullscreenElement){
          await document.exitFullscreen();
        }
      }catch(e){
        toast("Tu navegador bloque√≥ pantalla completa.");
      }
    });

    // ---------- Guided tour ----------
    const tourStops = ["#mapa", "#gravedad", "#tecnificado", "#calculadoras", "#quiz"];
    $("#btnArranque").addEventListener("click", ()=>{
      $("#statusTxt").textContent = "Recorrido guiado iniciado";
      toast("Vamos: Mapa ‚Üí Gravedad ‚Üí Tecnificado ‚Üí C√°lculos ‚Üí Quiz");
      location.hash = tourStops[0];
      let i=0;
      window.clearInterval(window._tour);
      window._tour = window.setInterval(()=>{
        i++;
        if (i>=tourStops.length){ window.clearInterval(window._tour); toast("Recorrido finalizado"); $("#statusTxt").textContent="Recorrido finalizado"; return; }
        document.querySelector(tourStops[i]).scrollIntoView({behavior:"smooth", block:"start"});
      }, 8500);
    });

    // ---------- Diagnostic quick button ----------
    $("#btnDiagnostico").addEventListener("click", ()=>{
      document.querySelector("#calculadoras").scrollIntoView({behavior:"smooth"});
      toast("Abre ‚ÄúDiagn√≥stico r√°pido‚Äù y eval√∫a.");
    });

    // ---------- Calculator 1 ----------
    function calcLamina(){
      const eto = parseFloat($("#eto").value);
      const ft  = parseFloat($("#ft").value);
      const kc  = parseFloat($("#kc").value);
      const ef  = parseFloat($("#ef").value);
      const areaHa = parseFloat($("#area").value);
      const gasto = parseFloat($("#gasto").value); // m3/h

      if([eto,ft,kc,ef,areaHa,gasto].some(v=>!isFinite(v))){
        $("#outLamina").textContent = "‚ö†Ô∏è Revisa los datos (solo n√∫meros).";
        return null;
      }
      if(ef<=0 || ef>1){
        $("#outLamina").textContent = "‚ö†Ô∏è La eficiencia debe estar entre 0 y 1.";
        return null;
      }

      const etc = eto * ft * kc;                      // mm
      const lr_mm = etc / ef;                         // mm
      const lr_m = lr_mm / 1000;                      // m
      const area_m2 = areaHa * 10000;                 // m2
      const vol_m3 = lr_m * area_m2;                  // m3
      const vol_L  = vol_m3 * 1000;                   // L
      const tr_h = vol_m3 / gasto;                    // hours

      const out = [
        `ETc = ETo √ó FT √ó Kc = ${fmt(eto,2)} √ó ${fmt(ft,2)} √ó ${fmt(kc,2)} = ${fmt(etc,2)} mm`,
        `LR = ETc / eficiencia = ${fmt(etc,2)} / ${fmt(ef,2)} = ${fmt(lr_mm,2)} mm`,
        `LR (m) = ${fmt(lr_m,4)} m`,
        `Volumen = LR √ó √Årea = ${fmt(lr_m,4)} √ó ${fmt(area_m2,0)} = ${fmt(vol_m3,2)} m¬≥ ‚âà ${fmt(vol_L,0)} L`,
        `Tiempo de riego = Vol / Gasto = ${fmt(vol_m3,2)} / ${fmt(gasto,2)} = ${fmt(tr_h,2)} h`
      ].join("\n");

      $("#outLamina").textContent = out;
      return {etc, lr_mm, lr_m, area_m2, vol_m3, vol_L, tr_h};
    }
    $("#btnCalc1").addEventListener("click", ()=>{
      const r = calcLamina();
      if(r){ toast("C√°lculo listo"); $("#statusTxt").textContent="C√°lculo de l√°mina actualizado"; }
    });
    $("#btnReset1").addEventListener("click", ()=>{
      $("#eto").value="5"; $("#ft").value="0.8"; $("#kc").value="0.7"; $("#ef").value="0.9"; $("#area").value="1"; $("#gasto").value="15";
      $("#outLamina").textContent="Ingresa datos para calcular‚Ä¶";
      toast("Calculadora reiniciada");
    });

    // ---------- Calculator 2 ----------
    function calcEmisores(){
      const n = parseFloat($("#nplantas").value);
      const g = parseFloat($("#ngoteros").value);
      const q = parseFloat($("#qgot").value); // L/h
      if([n,g,q].some(v=>!isFinite(v))){
        $("#outEmisores").textContent = "‚ö†Ô∏è Revisa los datos (solo n√∫meros).";
        return null;
      }
      const qLh = n * g * q;
      const q_m3h = qLh / 1000;
      $("#outEmisores").textContent =
        `Caudal total = Plantas √ó Goteros/planta √ó Caudal gotero\n`+
        `= ${fmt(n,0)} √ó ${fmt(g,0)} √ó ${fmt(q,2)} = ${fmt(qLh,0)} L/h ‚âà ${fmt(q_m3h,2)} m¬≥/h`;
      return {qLh, q_m3h};
    }
    $("#btnCalc2").addEventListener("click", ()=>{
      const r = calcEmisores();
      if(r){ toast("Caudal por emisores calculado"); $("#statusTxt").textContent="C√°lculo por emisores actualizado"; }
    });
    $("#btnReset2").addEventListener("click", ()=>{
      $("#nplantas").value="3332"; $("#ngoteros").value="2"; $("#qgot").value="4";
      $("#outEmisores").textContent="Ingresa datos para calcular‚Ä¶";
      toast("Calculadora reiniciada");
    });

    // ---------- Diagnostic logic ----------
    function recommend(){
      const topo = $("#topo").value;
      const suelo = $("#suelo").value;
      const agua = $("#agua").value;
      const cult = $("#cult").value;

      // Simple rule-based suggestions aligned with session concepts
      let rec = [];
      let why = [];

      if(agua==="baja"){
        rec.push("Goteo (riego localizado)");
        why.push("M√°ximo ahorro de agua y aplicaci√≥n precisa.");
      } else if (agua==="media"){
        rec.push("Microaspersi√≥n o goteo");
        why.push("Buen control con consumo moderado.");
      } else {
        // alta
        if(topo==="plano" && (cult==="extensivo") && (suelo!=="arenoso")){
          rec.push("Gravedad (surcos / melgas)");
          why.push("Bajo costo energ√©tico, √∫til en extensiones con pendiente suave.");
        } else {
          rec.push("Aspersi√≥n o pivote");
          why.push("Uniformidad y cobertura para varias condiciones.");
        }
      }

      if(topo==="ladera"){
        rec = rec.filter(x=>!x.includes("Gravedad"));
        rec.unshift("Goteo autocompensado (PC) o microaspersi√≥n");
        why.unshift("Pendiente: conviene emisores autocompensados para mantener uniformidad.");
      }

      if(suelo==="arenoso"){
        why.push("Suelos arenosos infiltran r√°pido: conviene riego localizado y goteros m√°s cercanos.");
      }
      if(suelo==="arcilloso"){
        why.push("Suelos arcillosos: movimiento lateral, goteros m√°s separados y control de tiempos.");
      }

      return {rec, why};
    }

    $("#btnDiag").addEventListener("click", ()=>{
      const {rec, why} = recommend();
      $("#outDiag").textContent = `‚úÖ Recomendaci√≥n: ${rec.join(" / ")}\n\nMotivos:\n- ${why.join("\n- ")}`;
      toast("Diagn√≥stico generado");
      $("#statusTxt").textContent="Diagn√≥stico r√°pido actualizado";
    });
    $("#btnResetDiag").addEventListener("click", ()=>{
      $("#topo").value="plano"; $("#suelo").value="arenoso"; $("#agua").value="alta"; $("#cult").value="extensivo";
      $("#outDiag").textContent="Responde y presiona ‚ÄúEvaluar‚Äù.";
      toast("Diagn√≥stico reiniciado");
    });

    // ---------- Quiz content ----------
    const quiz = [
      {
        q: "En riego por gravedad, el agua se distribuye principalmente gracias a:",
        a: ["Bombas centr√≠fugas", "Energ√≠a gravitatoria y pendiente del terreno", "Inyecci√≥n de fertilizantes", "Alta presi√≥n en tuber√≠as"],
        c: 1
      },
      {
        q: "Seg√∫n la sesi√≥n, un factor clave para elegir entre surcos, melgas o bordos es:",
        a: ["Color del suelo", "Pendiente del terreno", "Edad del tractor", "Tipo de fertilizante"],
        c: 1
      },
      {
        q: "En suelos arenosos (ligeros), por su mayor infiltraci√≥n, suele recomendarse:",
        a: ["Surcos largos y estrechos", "Melgas cortas y anchas", "Inundaci√≥n permanente", "Cero nivelaci√≥n"],
        c: 0
      },
      {
        q: "¬øCu√°l de los siguientes es un m√©todo de riego por gravedad?",
        a: ["Goteo", "Microaspersi√≥n", "Riego por surcos", "Subsuperficial"],
        c: 2
      },
      {
        q: "En la fase de avance del riego por surcos, el tiempo de avance se mide con intervalos de:",
        a: ["1 metro", "5 metros", "10 metros", "100 metros"],
        c: 2
      },
      {
        q: "Regla pr√°ctica: si la velocidad de infiltraci√≥n del suelo es mayor a 10 cm/h, se recomienda:",
        a: ["Evitar m√©todos de riego por gravedad", "Usar inundaci√≥n", "Incrementar longitud de surcos", "Reducir eficiencia"],
        c: 0
      },
      {
        q: "F√≥rmula empleada en la sesi√≥n para estimar ETc (en el ejemplo de l√°mina de riego):",
        a: ["ETc = ETo √ó FT √ó Kc", "ETc = Kc / ETo", "ETc = (ETo + Kc) √ó FT", "ETc = ETo √ó eficiencia"],
        c: 0
      },
      {
        q: "El riego tecnificado se caracteriza por aplicar el agua de manera:",
        a: ["Aleatoria y sin control", "Controlada, eficiente y localizada", "Solo por pendiente", "Exclusivamente por inundaci√≥n"],
        c: 1
      },
      {
        q: "Una parte t√≠pica de la infraestructura complementaria en tecnificado es:",
        a: ["Cabezal con filtros e inyecci√≥n de fertilizantes", "Surcos en contorno", "Barbecho con arado", "Estacas cada 10 m"],
        c: 0
      },
      {
        q: "En riego localizado, si hay pendiente o l√≠neas largas, conviene usar emisores:",
        a: ["No compensados", "Autocompensados (PC)", "Sin goteros", "De alta evaporaci√≥n"],
        c: 1
      }
    ];

    const qList = $("#qList");
    function renderQuiz(){
      qList.innerHTML = "";
      quiz.forEach((item, idx)=>{
        const box = document.createElement("div");
        box.className = "q";
        box.innerHTML = `
          <div class="qTop">
            <p class="qTitle">${idx+1}. ${item.q}</p>
            <div class="qMeta">1 punto</div>
          </div>
          <div class="opts">
            ${item.a.map((opt, j)=>`
              <label class="opt">
                <input type="radio" name="q${idx}" value="${j}" />
                <span>${opt}</span>
              </label>
            `).join("")}
          </div>
        `;
        qList.appendChild(box);
      });
    }
    renderQuiz();

    function getAnswers(){
      const ans = [];
      for(let i=0;i<quiz.length;i++){
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        ans.push(sel ? parseInt(sel.value,10) : null);
      }
      return ans;
    }

    function grade(){
      const ans = getAnswers();
      let score = 0;

      // Reset styles
      $$(".opt").forEach(o=>o.classList.remove("correct","wrong"));

      quiz.forEach((item, i)=>{
        const chosen = ans[i];
        const options = document.querySelectorAll(`input[name="q${i}"]`);
        options.forEach((inp)=>{
          const lab = inp.closest(".opt");
          const j = parseInt(inp.value,10);
          if(chosen !== null){
            if(j===item.c) lab.classList.add("correct");
            if(j===chosen && chosen!==item.c) lab.classList.add("wrong");
          }
        });
        if(chosen === item.c) score++;
      });

      $("#scoreBig").textContent = `${score} / ${quiz.length}`;
      const pct = Math.round((score/quiz.length)*100);
      $("#scoreSmall").textContent = `Resultado: ${pct}% ¬∑ ${score} correctas de ${quiz.length}.`;

      $("#statusTxt").textContent = "Quiz calificado";
      toast(`Puntaje: ${score}/${quiz.length}`);

      return {score, pct, ans};
    }

    $("#btnGrade").addEventListener("click", grade);

    $("#btnClear").addEventListener("click", ()=>{
      $$("input[type=radio]").forEach(i=>i.checked=false);
      $$(".opt").forEach(o=>o.classList.remove("correct","wrong"));
      $("#scoreBig").textContent = `0 / ${quiz.length}`;
      $("#scoreSmall").textContent = "Selecciona tus respuestas y presiona ‚ÄúCalificar‚Äù.";
      toast("Quiz limpiado");
      $("#statusTxt").textContent = "Listo para aprender";
    });

    // ---------- Save + export ----------
    const LS_KEY = "undc_riego_sesion2_registro_v1";
    function loadReg(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY) || "[]"); }catch(e){ return []; }
    }
    function saveReg(list){
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    function currentStudent(){
      const nombre = ($("#qNombre").value || "").trim();
      const apellido = ($("#qApellido").value || "").trim();
      const seccion = ($("#qSeccion").value || "").trim();
      return {nombre, apellido, seccion};
    }

    function validateStudent(){
      const s = currentStudent();
      if(!s.nombre || !s.apellido){
        toast("Completa Nombre y Apellido.");
        return null;
      }
      return s;
    }

    function updateSavedScoreBox(){
      const reg = loadReg();
      if(reg.length===0){ $("#savedScore").textContent = "‚Äî"; return; }
      const last = reg[reg.length-1];
      $("#savedScore").textContent = `${last.apellido}, ${last.nombre} ¬∑ ${last.score}/${quiz.length}`;
    }
    updateSavedScoreBox();

    $("#btnSave").addEventListener("click", ()=>{
      const s = validateStudent();
      if(!s) return;
      const g = grade();
      const reg = loadReg();
      const row = {
        timestamp: new Date().toISOString(),
        nombre: s.nombre,
        apellido: s.apellido,
        seccion: s.seccion,
        score: g.score,
        pct: g.pct
      };
      reg.push(row);
      saveReg(reg);
      updateSavedScoreBox();
      $("#statusTxt").textContent = "Puntaje guardado";
      toast("Puntaje guardado (local)");
    });

    function toCSV(rows){
      const header = ["timestamp","apellido","nombre","seccion","score","pct"];
      const esc = (v)=>(""+(v??"")).replaceAll('"','""');
      const lines = [header.join(",")].concat(rows.map(r=>header.map(h=>`"${esc(r[h])}"`).join(",")));
      return lines.join("\n");
    }

    function download(filename, content, mime="text/plain"){
      const blob = new Blob([content], {type:mime});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 3000);
    }

    $("#btnExport").addEventListener("click", ()=>{
      const rows = loadReg();
      if(rows.length===0){ toast("No hay registros para exportar."); return; }
      download("UNDC_Riego_Sesion2_RegistroQuiz.csv", toCSV(rows), "text/csv");
      toast("CSV exportado");
    });

    $("#btnDescargar").addEventListener("click", ()=>{
      const rows = loadReg();
      const pack = {
        generatedAt: new Date().toISOString(),
        quizRecords: rows,
        lastCalc: {
          lamina: calcLamina() || null,
          emisores: calcEmisores() || null
        }
      };
      download("UNDC_Riego_Sesion2_Resultados.json", JSON.stringify(pack, null, 2), "application/json");
      toast("Resultados exportados (JSON)");
    });

    // ---------- Key (teacher) ----------
    function renderKey(){
      const key = quiz.map((q,i)=>`${i+1}) ${String.fromCharCode(65+q.c)}`).join("  ¬∑  ");
      $("#keyBox").textContent = "Clave: " + key;
    }
    renderKey();
    $("#btnToggleKey").addEventListener("click", ()=>{
      const kb = $("#keyBox");
      const show = kb.style.display === "none";
      kb.style.display = show ? "block" : "none";
      toast(show ? "Clave visible" : "Clave oculta");
    });

    // ---------- Small UX ----------
    // When leaving fullscreen, exit presentation class
    document.addEventListener("fullscreenchange", ()=>{
      if(!document.fullscreenElement && document.body.classList.contains("presentation")){
        document.body.classList.remove("presentation");
        modeTxt.textContent = "Normal";
        $("#statusTxt").textContent = "Listo para aprender";
      }
    });

  </script>
</body>
</html>
